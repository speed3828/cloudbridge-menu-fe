###############################################################################
# ğŸ”’ ì „ì²´ ì•ˆì •í™” ì›Œí¬í”Œë¡œ â€“ ì—­í• Â·ì •ì±…Â·ë£¨í‹´ ë“±ë¡
###############################################################################

# ì—­í•  ì •ì˜
roles:
  CURSOR: "ì‹¤í–‰ ë‹´ë‹¹: íŒ¨ì¹˜ ì ìš©Â·í…ŒìŠ¤íŠ¸"
  GPT_O3: "í’ˆì§ˆ ë‹´ë‹¹: ì˜¤ë¥˜Â·ë³´ì•ˆ íŒ¨ì¹˜ ìë™ ì œì•ˆ"
  CLAUDE: "ë¦¬íŒ©í„° ë‹´ë‹¹: ì„±ëŠ¥Â·ê°€ë…ì„± ê°œì„  ì½”ë“œ ì œì•ˆ"
  HUMAN: "ì˜¤ë„ˆ: ìŠ¹ì¸ y/n"

# ì •ì±… ì„¤ì •
policy:
  AUTOSAVE: on
  STOP_ON_ERROR: true
  PREVIEW_ONLY: true
  CONFIRM_EACH: true

# ì²´í¬í¬ì¸íŠ¸
checkpoints:
  - trigger: BEFORE=*
    command: "bash scripts/quality_check.sh"
    confirm: false
  
  - trigger: AFTER=review:auto-fix
    command: "run apply:patch --auto && run show:diff"
    confirm: true
  
  - trigger: AFTER=scripts/quality_check.sh
    command: |
      git add .
      git commit -m 'chore: stable pass on $(date +%F_%T)'
      TAG=stable-$(date +%Y%m%d%H%M)
      git tag -a $TAG -m 'auto stable tag'
      git push origin main --follow-tags
      curl -X POST -H 'Content-Type: application/json' -d '{\"text\":\"âœ… ì „ì²´ ì•ˆì •í™” í†µê³¼ [$TAG]\"}' $SLACK_WEBHOOK_URL
    confirm: false

# ì˜¤ë¥˜ ì²˜ë¦¬
on_error:
  command: "run review:auto-fix --model=gpt-4o --log=$CURSOR_LAST_LOG"
  rollback_cmd: "git reset --hard HEAD~1"
  pause: true 